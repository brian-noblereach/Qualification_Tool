<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Venture Assessment Platform</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
<div class="container">
  <!-- Header -->
  <header class="header">
    <div class="company-info">
      <h1 id="companyName">Venture Assessment Platform</h1>
      <div id="companyMeta">Enter technology description to begin assessment</div>
    </div>
	<div class="header-actions">
	  <button id="newAnalysisBtn" class="btn btn-secondary" style="display:none;">
		<span class="btn-icon">â†º</span> New Analysis
	  </button>
	  <button id="exportBtn" class="btn btn-primary" style="display:none;" aria-label="Export Report">
		<span class="btn-icon">ðŸ“„</span> Export Report
	  </button>
	</div>
  </header>

  <!-- Input Section -->
	<section id="inputSection" class="input-section">
	  <div class="card">
		<h2>Technology Description</h2>
		<textarea 
		  id="techDescription" 
		  placeholder="Describe the technology, its use case, and context..."
		  minlength="20"
		  aria-label="Technology description"
		  aria-describedby="techDescriptionHint"
		></textarea>
		<div id="techDescriptionHint" class="field-helper">
		  Minimum 20 characters. Be as detailed as possible for better analysis.
		</div>
		<div class="actions">
		  <button id="analyzeBtn" class="btn btn-primary" aria-label="Start Analysis">
			Analyze
		  </button>
		</div>
	  </div>
	</section>

  <!-- Loading Section (must remain flex to stay centered) -->
	<section id="loadingSection" class="loading-section" style="display:none;">
	  <div class="loading-modal">
		<div class="loading-header">
		  <div class="phase-indicators">
			<div class="phase-indicator" data-phase="competitive">
			  <span class="phase-dot"></span>
			  Competitive
			</div>
			<div class="phase-connector"></div>
			<div class="phase-indicator" data-phase="market">
			  <span class="phase-dot"></span>
			  Market
			</div>
		  </div>
		  <h3 id="loadingTitle">Preparing analysisâ€¦</h3>
		</div>
		<div class="loading-body">
		  <div class="spinner"></div>
		  <div class="progress-bar-container">
			<div id="progressBar" class="progress-bar"></div>
		  </div>
		  <div class="status">
			<span id="progressStatus">Initializingâ€¦</span>
			<span id="timeElapsed">0:00</span>
		  </div>
		</div>
	  </div>
	</section>

  <!-- Error Section -->
	<section id="errorSection" class="error-section" style="display:none;">
	  <div class="error-content">
		<div class="card">
		  <h2>âš  Something went wrong</h2>
		  <p id="errorMessage"></p>
		  <details id="errorDetailsWrapper" style="display:none;">
			<summary>Technical Details</summary>
			<pre id="errorDetails"></pre>
		  </details>
		  <div class="actions">
			<button id="retryBtn" class="btn btn-secondary">Retry Analysis</button>
			<button onclick="App.startNewAnalysis()" class="btn btn-primary">Start Over</button>
		  </div>
		</div>
	  </div>
	</section>

  <!-- Assessment Section -->
  <section id="assessmentSection" class="assessment-section" style="display:none;">
    <div id="assessmentTabs" class="assessment-tabs" style="display:none;">
      <div class="assessment-tab active" data-assessment="competitive">
        Competitive <span class="tab-score" id="competitiveTabScore"></span>
        <span class="badge" id="competitiveAiScore"></span>
      </div>
      <div class="assessment-tab" data-assessment="market">
        Market <span class="tab-score" id="marketTabScore"></span>
        <span class="badge" id="marketAiScore"></span>
      </div>
      <div class="assessment-tab" data-assessment="summary">Summary</div>
    </div>

    <div id="assessmentProgress" class="assessment-progress" style="display:none;">
      <div class="progress-item" data-assessment="competitive">Competitive</div>
      <div class="progress-item" data-assessment="market">Market</div>
    </div>

    <!-- Competitive Assessment -->
    <div id="competitiveAssessment">
      <div class="view-tabs">
        <button class="tab active" data-assessment="competitive" data-view="summary">Summary</button>
        <button class="tab" data-assessment="competitive" data-view="detailed">Detailed</button>
        <button class="tab" data-assessment="competitive" data-view="sources">Sources</button>
      </div>

      <!-- Competitive Summary View -->
      <div id="competitiveSummaryView">
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-label">Total Competitors</div>
            <div class="metric-value" id="competitorCount">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Market Leaders</div>
            <div class="metric-value" id="marketLeaderCount">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Competitive Intensity</div>
            <div class="metric-value" id="competitiveIntensity">-</div>
          </div>
          <!-- NEW: Competitive Analysis Confidence (matches market style) -->
          <div class="metric-card">
            <div class="metric-label">Analysis Confidence</div>
            <div class="metric-value" id="competitiveConfidence">-</div>
          </div>
        </div>

        <div class="two-col">
          <div class="card">
            <h3>AI Reasoning</h3>
            <p id="competitiveAiReasoning">-</p>
          </div>
          <div class="card">
            <h3>Rubric</h3>
            <div id="competitiveRubricDescription"></div>
            <div class="rubric-controls">
              <div id="competitiveRubricTable" class="rubric-table"></div>
              <div class="slider-row">
                <input id="competitiveUserScoreSlider" type="range" min="1" max="9" value="5"/>
                <span id="competitiveUserScoreDisplay">5</span>
              </div>
              <textarea id="competitiveScoreComment" placeholder="Add your justificationâ€¦"></textarea>
              <div class="deviation" id="competitiveDeviationWarning" style="display:none;"></div>
              <button id="competitiveSubmitBtn" class="btn btn-primary">Submit Assessment</button>
            </div>
          </div>
        </div>

        <div class="two-col">
          <div class="card">
            <h3>Key Risks</h3>
            <ul id="competitiveRisksList" class="formatted-list"></ul>
          </div>
          <div class="card">
            <h3>Opportunities</h3>
            <ul id="competitiveOpportunitiesList" class="formatted-list"></ul>
          </div>
        </div>
      </div>

      <!-- Competitive Detailed View -->
      <div id="competitiveDetailedView" style="display:none;">
        <div class="card">
          <h3>Competitor Breakdown</h3>
          <div id="competitorBreakdown" class="competitor-breakdown"></div>
        </div>
        <div class="card">
          <h3>Market Leaders & Detailed Competitors</h3>
          <div id="marketLeadersList" class="leaders-list"></div>
        </div>
        <div class="two-col">
          <div class="card">
            <h3>All Risks</h3>
            <ul id="allCompetitiveRisksList" class="formatted-list"></ul>
          </div>
          <div class="card">
            <h3>All Opportunities</h3>
            <ul id="allCompetitiveOpportunitiesList" class="formatted-list"></ul>
          </div>
        </div>
      </div>

      <!-- Competitive Sources View (now driven by data_quality.sources_used) -->
      <div id="competitiveSourcesView" style="display:none;">
        <!-- Filled by AssessmentComponent.loadCompetitiveSources -->
      </div>
    </div>

    <!-- Market Assessment -->
    <div id="marketAssessment" style="display:none;">
      <div class="view-tabs">
        <button class="tab active" data-assessment="market" data-view="summary">Summary</button>
        <button class="tab" data-assessment="market" data-view="detailed">Detailed</button>
        <button class="tab" data-assessment="market" data-view="sources">Sources</button>
      </div>

      <!-- Market Summary View -->
      <div id="marketSummaryView">
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-label">TAM</div>
            <div class="metric-value" id="tamValue">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">CAGR</div>
            <div class="metric-value" id="cagrValue">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Primary Market</div>
            <div class="metric-value" id="marketDesc">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Analysis Confidence</div>
            <div class="metric-value" id="marketConfidence">-</div>
          </div>
        </div>

		 <div class="two-col">
			<div class="card">
			  <h3>AI Reasoning</h3>
			  <p id="marketAiReasoning">-</p>
			</div>
			<div class="card">
			  <h3>Rubric</h3>
			  <div id="marketRubricDescription"></div>
			  <div class="rubric-controls">
				<div id="marketRubricTable" class="rubric-table"></div>
				<div class="slider-row">
				  <input id="marketUserScoreSlider" type="range" min="1" max="9" value="5"/>
				  <span id="marketUserScoreDisplay">5</span>
				</div>
				<textarea id="marketScoreComment" placeholder="Add your justificationâ€¦"></textarea>
				<div class="deviation" id="marketDeviationWarning" style="display:none;"></div>
				<button id="marketSubmitBtn" class="btn btn-primary">Submit Assessment</button>
			  </div>
			</div>
		  </div>
		  
		  <!-- Add missing summary lists -->
		  <div class="two-col">
			<div class="card">
			  <h3>Key Strengths</h3>
			  <ul id="marketStrengthsList" class="formatted-list"></ul>
			</div>
			<div class="card">
			  <h3>Key Limitations</h3>
			  <ul id="marketLimitationsList" class="formatted-list"></ul>
			</div>
		  </div>
		</div>

      <!-- Market Detailed View -->
      <div id="marketDetailedView" style="display:none;">
        <div class="card">
          <h3>Market Analysis</h3>
          <div id="marketAnalysis"></div>
        </div>
        <div class="two-col">
          <div class="card">
            <h3>All Strengths</h3>
            <ul id="allMarketStrengthsList" class="formatted-list"></ul>
          </div>
          <div class="card">
            <h3>All Limitations</h3>
            <ul id="allMarketLimitationsList" class="formatted-list"></ul>
          </div>
        </div>
        <div class="card">
          <h3>Key Risks</h3>
          <ul id="marketRisksList" class="formatted-list"></ul>
        </div>
      </div>

      <!-- Market Sources View -->
      <div id="marketSourcesView" style="display:none;">
        <div class="card">
          <h3>Market Size Sources</h3>
          <table class="sources-table">
            <thead>
              <tr>
                <th>Description</th>
                <th>TAM</th>
                <th>CAGR</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody id="marketSourcesTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Summary Section -->
    <div id="summarySection" style="display:none;">
      <div class="two-col">
        <div class="card">
          <h3>Competitive Assessment</h3>
          <div>AI Score: <span id="summaryCompetitiveAi">-</span></div>
          <div>User Score: <span id="summaryCompetitiveUser">-</span></div>
          <p id="summaryCompetitiveJustification">No assessment provided yet</p>
        </div>
        <div class="card">
          <h3>Market Assessment</h3>
          <div>AI Score: <span id="summaryMarketAi">-</span></div>
          <div>User Score: <span id="summaryMarketUser">-</span></div>
          <p id="summaryMarketJustification">No assessment provided yet</p>
        </div>
      </div>
      <div class="card">
        <h3>Overall</h3>
        <div class="overall-stats">
          <div>AI Average: <span id="overallAiAverage">-</span></div>
          <div>User Average: <span id="overallUserAverage">-</span></div>
          <div>Assessments Completed: <span id="assessmentStatus">0/2</span></div>
        </div>
        <div class="actions">
          <button id="finalExportBtn" class="btn btn-primary">Export Full Report</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Scripts -->
  <script src="js/utils/formatters.js"></script>
  <script src="js/state/store.js"></script>
  <script src="js/utils/export.js"></script>
  <script src="js/api/competitive.js"></script>
  <script src="js/api/market.js"></script>
  <script src="js/components/rubric.js"></script>
  <script src="js/components/evidence.js"></script>
  <script src="js/components/assessment.js"></script>
  <script src="js/app.js"></script>
  </div>
</body>
</html>
